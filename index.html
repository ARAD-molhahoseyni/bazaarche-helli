<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª Ø¨Ø§Ø²Ø§Ø±Ú†Ù‡ - Ø¯Ø¨ÛŒØ±Ø³ØªØ§Ù† Ø¹Ù„Ø§Ù…Ù‡ Ø­Ù„ÛŒ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Vazir', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ğŸ¨ Header Ø¨Ù‡Ø¨ÙˆØ¯ ÛŒØ§ÙØªÙ‡ */
        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .header .subtitle {
            color: #7f8c8d;
            font-size: 1.3em;
            font-weight: 300;
        }

        .header .school-info {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            padding: 12px 25px;
            border-radius: 25px;
            margin: 15px auto 0;
            display: inline-block;
            font-weight: bold;
            font-size: 1.1em;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
        }

        /* ğŸ¨ ØµÙØ­Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ ÙˆØ±ÙˆØ¯ */
        .login-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            max-width: 600px;
            margin: 50px auto;
        }

        .login-option {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            backdrop-filter: blur(10px);
        }

        .login-option:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.25);
        }

        .login-option .icon {
            font-size: 4em;
            margin-bottom: 15px;
            display: block;
        }

        .login-option .title {
            font-size: 1.4em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .login-option .desc {
            color: #7f8c8d;
            font-size: 0.95em;
        }

        /* ğŸ¨ Ù¾Ù†Ù„â€ŒÙ‡Ø§ */
        .panel {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
        }

        .panel.active {
            display: block;
            animation: fadeInUp 0.5s ease;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ğŸ¨ ÙØ±Ù…â€ŒÙ‡Ø§ */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1em;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        /* ğŸ¨ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ */
        .btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.6);
        }

        .btn-success {
            background: linear-gradient(45deg, #27ae60, #219a52);
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.4);
        }

        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
        }

        .btn-back {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
            margin-left: 10px;
            box-shadow: 0 4px 15px rgba(149, 165, 166, 0.4);
        }

        /* ğŸ¨ Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§ */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 12px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            animation: slideInRight 0.5s ease;
        }

        .notification.success {
            background: linear-gradient(45deg, #27ae60, #219a52);
        }

        .notification.error {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* ğŸ¨ Ø¬Ø¯Ø§ÙˆÙ„ */
        .table-container {
            overflow-x: auto;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin: 20px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th {
            background: linear-gradient(45deg, #34495e, #2c3e50);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
        }

        td {
            padding: 12px 15px;
            text-align: center;
            border-bottom: 1px solid #ecf0f1;
        }

        tr:nth-child(even) {
            background: #f8f9fa;
        }

        tr:hover {
            background: #e3f2fd;
        }

        /* ğŸ¨ Ù…ÙˆØ¨Ø§ÛŒÙ„ */
        @media (max-width: 768px) {
            .login-selector {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .header .school-info {
                font-size: 1em;
                padding: 10px 20px;
            }
            
            .login-option {
                padding: 30px 20px;
            }
            
            .login-option .icon {
                font-size: 3em;
            }
        }

        /* ğŸ¨ Search Results */
        .search-results {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: white;
            margin-top: 5px;
        }

        .search-result-item {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.2s;
        }

        .search-result-item:hover {
            background: #f8f9fa;
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        /* ğŸ¨ Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 1.1em;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸª Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª Ø¨Ø§Ø²Ø§Ø±Ú†Ù‡</h1>
            <div class="subtitle">Ù…Ø¯ÛŒØ±ÛŒØª Ù‡ÙˆØ´Ù…Ù†Ø¯ ÙØ±ÙˆØ´ Ùˆ Ø®Ø¯Ù…Ø§Øª</div>
            <div class="school-info">
                ğŸ“ Ø¯Ø¨ÛŒØ±Ø³ØªØ§Ù† Ø¹Ù„Ø§Ù…Ù‡ Ø­Ù„ÛŒ - Ø¯ÙˆØ±Ù‡ Ø§ÙˆÙ„ Ù…ØªÙˆØ³Ø·Ù‡
            </div>
        </div>

        <!-- ØµÙØ­Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ ÙˆØ±ÙˆØ¯ -->
        <div id="loginSelector" class="login-selector">
            <div class="login-option" onclick="showPanel('panelStallLogin')">
                <span class="icon">ğŸ§‘â€ğŸ³</span>
                <div class="title">Ù¾Ù†Ù„ ÙØ±ÙˆØ´Ù†Ø¯Ù‡</div>
                <div class="desc">Ø«Ø¨Øª ÙØ±ÙˆØ´ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª ØºØ±ÙÙ‡</div>
            </div>
            <div class="login-option" onclick="showPanel('panelAdminLogin')">
                <span class="icon">ğŸ‘¨â€ğŸ’¼</span>
                <div class="title">Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</div>
                <div class="desc">Ú¯Ø²Ø§Ø±Ø´â€ŒÚ¯ÛŒØ±ÛŒ Ùˆ Ù†Ø¸Ø§Ø±Øª Ú©Ù„ÛŒ</div>
            </div>
        </div>

        <!-- Ù¾Ù†Ù„ ÙˆØ±ÙˆØ¯ ÙØ±ÙˆØ´Ù†Ø¯Ù‡ -->
        <div id="panelStallLogin" class="panel">
            <h2>ğŸ§‘â€ğŸ³ ÙˆØ±ÙˆØ¯ Ù¾Ù†Ù„ ÙØ±ÙˆØ´Ù†Ø¯Ù‡</h2>
            <form onsubmit="stallLogin(event)">
                <div class="form-group">
                    <label>Ú©Ø¯ ØºØ±ÙÙ‡:</label>
                    <input type="text" id="stallCode" placeholder="Ù…Ø«Ø§Ù„: FOOD1" required>
                </div>
                <div class="form-group">
                    <label>Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±:</label>
                    <input type="password" id="stallPassword" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± ØºØ±ÙÙ‡" required>
                </div>
                <button type="submit" class="btn">ÙˆØ±ÙˆØ¯</button>
                <button type="button" class="btn btn-back" onclick="showPanel('loginSelector')">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
            </form>
            
            <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px; font-size: 0.9em;">
                <strong>ğŸ”‘ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙˆØ±ÙˆØ¯ Ù†Ù…ÙˆÙ†Ù‡:</strong><br>
                â€¢ ØºØ±ÙÙ‡ ØºØ°Ø§: <code>FOOD1</code> / <code>food123</code><br>
                â€¢ ØºØ±ÙÙ‡ Ù†ÙˆØ´ÛŒØ¯Ù†ÛŒ: <code>DRINK1</code> / <code>drink123</code><br>
                â€¢ ØºØ±ÙÙ‡ ØªÙ†Ù‚Ù„Ø§Øª: <code>SNACK1</code> / <code>snack123</code><br>
                â€¢ ØºØ±ÙÙ‡ Ú©ØªØ§Ø¨: <code>BOOK1</code> / <code>book123</code>
            </div>
        </div>

        <!-- Ù¾Ù†Ù„ ÙˆØ±ÙˆØ¯ Ù…Ø¯ÛŒØ±ÛŒØª -->
        <div id="panelAdminLogin" class="panel">
            <h2>ğŸ‘¨â€ğŸ’¼ ÙˆØ±ÙˆØ¯ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</h2>
            <form onsubmit="adminLogin(event)">
                <div class="form-group">
                    <label>Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ù…Ø¯ÛŒØ±:</label>
                    <input type="password" id="adminPassword" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ù…Ø¯ÛŒØ±ÛŒØª" required>
                </div>
                <button type="submit" class="btn">ÙˆØ±ÙˆØ¯</button>
                <button type="button" class="btn btn-back" onclick="showPanel('loginSelector')">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
            </form>
            
            <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px; font-size: 0.9em;">
                <strong>ğŸ”‘ Ø±Ù…Ø² Ù…Ø¯ÛŒØ±:</strong> <code>admin123</code>
            </div>
        </div>

        <!-- Ù¾Ù†Ù„ ÙØ±ÙˆØ´Ù†Ø¯Ù‡ (Ø¨Ø¹Ø¯ Ø§Ø² ÙˆØ±ÙˆØ¯) -->
        <div id="panelStallMain" class="panel">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h2 id="stallWelcome">Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯</h2>
                <button class="btn btn-back" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
            </div>

            <!-- Ø«Ø¨Øª ÙØ±ÙˆØ´ Ø¬Ø¯ÛŒØ¯ -->
            <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; margin-bottom: 25px;">
                <h3>ğŸ“ Ø«Ø¨Øª ÙØ±ÙˆØ´ Ø¬Ø¯ÛŒØ¯</h3>
                <div class="form-group">
                    <label>Ø¬Ø³ØªØ¬ÙˆÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²:</label>
                    <input type="text" id="studentSearch" placeholder="Ù†Ø§Ù…ØŒ Ú©Ø¯ ÛŒØ§ Ú©Ù„Ø§Ø³ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²..." onkeyup="searchStudent()">
                    <div id="searchResults" class="search-results" style="display: none;"></div>
                </div>
                <div class="form-group">
                    <label>Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡:</label>
                    <input type="text" id="selectedStudent" readonly placeholder="Ø§Ø¨ØªØ¯Ø§ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø±Ø§ Ø¬Ø³ØªØ¬Ùˆ Ú©Ù†ÛŒØ¯">
                </div>
                <div class="form-group">
                    <label>Ù…Ø¨Ù„Øº (ØªÙˆÙ…Ø§Ù†):</label>
                    <input type="number" id="saleAmount" placeholder="Ù…Ø«Ø§Ù„: 50000">
                </div>
                <div class="form-group">
                    <label>Ù†ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø®Øª:</label>
                    <select id="paymentType">
                        <option value="Ù†Ù‚Ø¯">ğŸ’° Ù†Ù‚Ø¯</option>
                        <option value="Ù†Ø³ÛŒÙ‡">ğŸ“ Ù†Ø³ÛŒÙ‡</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ø´Ø±Ø­ Ø§Ù‚Ù„Ø§Ù…:</label>
                    <textarea id="saleDescription" placeholder="Ù…Ø«Ø§Ù„: Ù¾ÛŒØªØ²Ø§ØŒ Ù†ÙˆØ´ÛŒØ¯Ù†ÛŒØŒ ØªÙ†Ù‚Ù„Ø§Øª..." rows="3"></textarea>
                </div>
                <button class="btn btn-success" onclick="submitSale()">ğŸ’¾ Ø«Ø¨Øª ÙØ±ÙˆØ´</button>
            </div>

            <!-- ØªØ§Ø±ÛŒØ®Ú†Ù‡ ÙØ±ÙˆØ´ -->
            <h3>ğŸ“Š ØªØ§Ø±ÛŒØ®Ú†Ù‡ ÙØ±ÙˆØ´ Ø§Ù…Ø±ÙˆØ²</h3>
            <div id="stallSalesTable"></div>
        </div>

        <!-- Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª (Ø¨Ø¹Ø¯ Ø§Ø² ÙˆØ±ÙˆØ¯) -->
        <div id="panelAdminMain" class="panel">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h2>ğŸ‘¨â€ğŸ’¼ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</h2>
                <button class="btn btn-back" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
            </div>

            <!-- Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ -->
            <div id="adminStats" class="stats-grid"></div>

            <!-- Ù…Ù†ÙˆÛŒ Ù…Ø¯ÛŒØ±ÛŒØª -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 25px 0;">
                <button class="btn" onclick="showAdminTab('uploadStudents')">ğŸ“‹ Ø¢Ù¾Ù„ÙˆØ¯ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†</button>
                <button class="btn" onclick="showAdminTab('stallStats')">ğŸ“ˆ Ø¢Ù…Ø§Ø± ØºØ±ÙÙ‡â€ŒÙ‡Ø§</button>
                <button class="btn" onclick="showAdminTab('debtors')">ğŸ’³ Ù„ÛŒØ³Øª Ø¨Ø¯Ù‡Ú©Ø§Ø±Ø§Ù†</button>
                <button class="btn" onclick="showAdminTab('allSales')">ğŸ“Š Ú©Ù„ ÙØ±ÙˆØ´â€ŒÙ‡Ø§</button>
            </div>

            <!-- Ø¨Ø®Ø´ Ø¢Ù¾Ù„ÙˆØ¯ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† -->
            <div id="adminUploadStudents" style="display: none;">
                <h3>ğŸ“‹ Ø¢Ù¾Ù„ÙˆØ¯ Ù„ÛŒØ³Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†</h3>
                <div class="form-group">
                    <input type="file" id="studentsFile" accept=".xlsx,.xls" onchange="handleStudentsUpload(event)">
                </div>
                <small>ÙØ±Ù…Øª Ø§Ú©Ø³Ù„: Ú©Ø¯ | Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ | Ú©Ù„Ø§Ø³</small>
            </div>

            <!-- Ø¨Ø®Ø´ Ø¢Ù…Ø§Ø± ØºØ±ÙÙ‡â€ŒÙ‡Ø§ -->
            <div id="adminStallStats" style="display: none;">
                <h3>ğŸ“ˆ Ø¢Ù…Ø§Ø± ÙØ±ÙˆØ´ ØºØ±ÙÙ‡â€ŒÙ‡Ø§</h3>
                <div id="stallStatsChart"></div>
            </div>

            <!-- Ø¨Ø®Ø´ Ø¨Ø¯Ù‡Ú©Ø§Ø±Ø§Ù† -->
            <div id="adminDebtors" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h3>ğŸ’³ Ù„ÛŒØ³Øª Ø¨Ø¯Ù‡Ú©Ø§Ø±Ø§Ù†</h3>
                    <button class="btn btn-success" onclick="downloadDebtorsExcel()">ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯ Excel</button>
                </div>
                <div id="debtorsTable"></div>
            </div>

            <!-- Ø¨Ø®Ø´ Ú©Ù„ ÙØ±ÙˆØ´â€ŒÙ‡Ø§ -->
            <div id="adminAllSales" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h3>ğŸ“Š Ú©Ù„ ÙØ±ÙˆØ´â€ŒÙ‡Ø§</h3>
                    <button class="btn btn-success" onclick="downloadAllSalesExcel()">ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯ Excel</button>
                </div>
                <div id="allSalesTable"></div>
            </div>
        </div>
    </div>

    <!-- Script Ø´Ø§Ù…Ù„ SheetJS Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø± Ø¨Ø§ Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <script>
        // ğŸ”§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÙˆÙ„ÛŒÙ‡
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyrhuxHimdZ41WS8MJtTX8B8L55BSI9p6igloKqBxDqJm8vpCudt72IOdjV9i_j2g7k/exec'; // âš ï¸ URL Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯
        
        let currentStall = null;
        let selectedStudentData = null;
        let searchTimeout = null;

        // ğŸ¯ Ù†Ù…Ø§ÛŒØ´ Ù¾Ù†Ù„â€ŒÙ‡Ø§
        function showPanel(panelId) {
            // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ù¾Ù†Ù„â€ŒÙ‡Ø§
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            document.getElementById('loginSelector').style.display = 'none';
            
            if (panelId === 'loginSelector') {
                document.getElementById('loginSelector').style.display = 'grid';
            } else {
                document.getElementById(panelId).classList.add('active');
            }
        }

        // ğŸ”” Ù†Ù…Ø§ÛŒØ´ Ø§Ø¹Ù„Ø§Ù†
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 4000);
        }

        // ğŸ“¡ Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ù‡ Ø³Ø±ÙˆØ±
        async function sendRequest(data) {
            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                return result;
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±:', error);
                showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±', 'error');
                return { success: false, message: 'Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±' };
            }
        }

        // ğŸ§‘â€ğŸ³ ÙˆØ±ÙˆØ¯ ÙØ±ÙˆØ´Ù†Ø¯Ù‡
        async function stallLogin(event) {
            event.preventDefault();
            
            const code = document.getElementById('stallCode').value;
            const password = document.getElementById('stallPassword').value;
            
            const result = await sendRequest({
                type: 'stallLogin',
                code: code,
                password: password
            });
            
            if (result.success) {
                currentStall = result;
                document.getElementById('stallWelcome').textContent = `ğŸ§‘â€ğŸ³ ${result.name}`;
                showPanel('panelStallMain');
                loadStallSales();
                showNotification('ÙˆØ±ÙˆØ¯ Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ø¨ÙˆØ¯');
            } else {
                showNotification(result.message || 'Ø®Ø·Ø§ Ø¯Ø± ÙˆØ±ÙˆØ¯', 'error');
            }
        }

        // ğŸ‘¨â€ğŸ’¼ ÙˆØ±ÙˆØ¯ Ù…Ø¯ÛŒØ±
        async function adminLogin(event) {
            event.preventDefault();
            
            const password = document.getElementById('adminPassword').value;
            
            const result = await sendRequest({
                type: 'adminLogin',
                password: password
            });
            
            if (result.success) {
                showPanel('panelAdminMain');
                loadAdminStats();
                showNotification('ÙˆØ±ÙˆØ¯ Ù…Ø¯ÛŒØ± Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ø¨ÙˆØ¯');
            } else {
                showNotification(result.message || 'Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª', 'error');
            }
        }

        // ğŸ” Ø¬Ø³ØªØ¬ÙˆÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²
        async function searchStudent() {
            const query = document.getElementById('studentSearch').value.trim();
            const resultsDiv = document.getElementById('searchResults');
            
            if (query.length < 2) {
                resultsDiv.style.display = 'none';
                return;
            }
            
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(async () => {
                const result = await sendRequest({
                    type: 'searchStudent',
                    query: query
                });
                
                if (result.success && result.students.length > 0) {
                    let html = '';
                    result.students.forEach(student => {
                        html += `<div class="search-result-item" onclick="selectStudent('${student.code}', '${student.name}', '${student.class}')">
                            <strong>${student.name}</strong> - ${student.class} - Ú©Ø¯: ${student.code}
                        </div>`;
                    });
                    resultsDiv.innerHTML = html;
                    resultsDiv.style.display = 'block';
                } else {
                    resultsDiv.innerHTML = '<div class="search-result-item">Ù…ÙˆØ±Ø¯ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</div>';
                    resultsDiv.style.display = 'block';
                }
            }, 300);
        }

        // âœ… Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²
        function selectStudent(code, name, studentClass) {
            selectedStudentData = { code, name, class: studentClass };
            document.getElementById('selectedStudent').value = `${name} - ${studentClass} (${code})`;
            document.getElementById('searchResults').style.display = 'none';
            document.getElementById('studentSearch').value = '';
        }

        // ğŸ’¾ Ø«Ø¨Øª ÙØ±ÙˆØ´
        async function submitSale() {
            if (!selectedStudentData) {
                showNotification('Ù„Ø·ÙØ§Ù‹ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯', 'error');
                return;
            }
            
            const amount = document.getElementById('saleAmount').value;
            const paymentType = document.getElementById('paymentType').value;
            const description = document.getElementById('saleDescription').value;
            
            if (!amount || !description) {
                showNotification('Ù„Ø·ÙØ§Ù‹ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯', 'error');
                return;
            }
            
            const result = await sendRequest({
                type: 'submitSale',
                studentCode: selectedStudentData.code,
                studentName: selectedStudentData.name,
                stallName: currentStall.name,
                amount: parseInt(amount),
                paymentType: paymentType,
                description: description
            });
            
            if (result.success) {
                showNotification('ÙØ±ÙˆØ´ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯');
                // Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† ÙØ±Ù…
                document.getElementById('saleAmount').value = '';
                document.getElementById('saleDescription').value = '';
                document.getElementById('selectedStudent').value = '';
                selectedStudentData = null;
                // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¬Ø¯Ø¯ ÙØ±ÙˆØ´â€ŒÙ‡Ø§
                loadStallSales();
            } else {
                showNotification(result.message || 'Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª ÙØ±ÙˆØ´', 'error');
            }
        }

        // ğŸ“Š Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ±ÙˆØ´â€ŒÙ‡Ø§ÛŒ ØºØ±ÙÙ‡
        async function loadStallSales() {
            if (!currentStall) return;
            
            const result = await sendRequest({
                type: 'getStallSales',
                stallName: currentStall.name
            });
            
            if (result.success) {
                let html = '<div class="table-container"><table><thead><tr>';
                html += '<th>ØªØ§Ø±ÛŒØ®</th><th>Ø³Ø§Ø¹Øª</th><th>Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²</th><th>Ù…Ø¨Ù„Øº</th><th>Ù†ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø®Øª</th><th>Ø´Ø±Ø­</th>';
                html += '</tr></thead><tbody>';
                
                if (result.sales.length === 0) {
                    html += '<tr><td colspan="6">Ù‡Ù†ÙˆØ² ÙØ±ÙˆØ´ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</td></tr>';
                } else {
                    result.sales.forEach(sale => {
                        const paymentBadge = sale.paymentType === 'Ù†Ù‚Ø¯' ? 
                            '<span style="background: #27ae60; color: white; padding: 4px 8px; border-radius: 8px; font-size: 0.8em;">ğŸ’° Ù†Ù‚Ø¯</span>' :
                            '<span style="background: #e74c3c; color: white; padding: 4px 8px; border-radius: 8px; font-size: 0.8em;">ğŸ“ Ù†Ø³ÛŒÙ‡</span>';
                        
                        html += `<tr>
                            <td>${sale.date}</td>
                            <td>${sale.time}</td>
                            <td>${sale.studentName}</td>
                            <td>${parseInt(sale.amount).toLocaleString()} ØªÙˆÙ…Ø§Ù†</td>
                            <td>${paymentBadge}</td>
                            <td>${sale.description}</td>
                        </tr>`;
                    });
                }
                
                html += '</tbody></table></div>';
                document.getElementById('stallSalesTable').innerHTML = html;
            }
        }

        // ğŸ“ˆ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¢Ù…Ø§Ø± Ù…Ø¯ÛŒØ±ÛŒØª
        async function loadAdminStats() {
            const result = await sendRequest({
                type: 'getStats'
            });
            
            if (result.success) {
                const stats = result.stats;
                const html = `
                    <div class="stat-card">
                        <div class="stat-number">${stats.totalSales.toLocaleString()}</div>
                        <div class="stat-label">Ú©Ù„ ÙØ±ÙˆØ´ (ØªÙˆÙ…Ø§Ù†)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${stats.totalTransactions}</div>
                        <div class="stat-label">ØªØ¹Ø¯Ø§Ø¯ ØªØ±Ø§Ú©Ù†Ø´</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${stats.totalStudents}</div>
                        <div class="stat-label">ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${stats.totalDebt.toLocaleString()}</div>
                        <div class="stat-label">Ú©Ù„ Ø¨Ø¯Ù‡ÛŒ (ØªÙˆÙ…Ø§Ù†)</div>
                    </div>
                `;
                document.getElementById('adminStats').innerHTML = html;
            }
        }

        // ğŸ—‚ï¸ Ù†Ù…Ø§ÛŒØ´ ØªØ¨â€ŒÙ‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª
        function showAdminTab(tabName) {
            // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ ØªØ¨â€ŒÙ‡Ø§
            document.querySelectorAll('#panelAdminMain > div[id^="admin"]').forEach(div => {
                if (div.id !== 'adminStats') {
                    div.style.display = 'none';
                }
            });
            
            // Ù†Ù…Ø§ÛŒØ´ ØªØ¨ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
            document.getElementById(`admin${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`).style.display = 'block';
            
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ¨
            switch(tabName) {
                case 'stallStats':
                    loadStallStats();
                    break;
                case 'debtors':
                    loadDebtors();
                    break;
                case 'allSales':
                    loadAllSales();
                    break;
            }
        }

        // ğŸ“Š Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¢Ù…Ø§Ø± ØºØ±ÙÙ‡â€ŒÙ‡Ø§
        async function loadStallStats() {
            const result = await sendRequest({
                type: 'getStallStats'
            });
            
            if (result.success) {
                const stats = result.stats;
                const maxAmount = Math.max(...stats.map(s => s.total), 1);
                
                let html = '';
                stats.forEach(stat => {
                    const percentage = (stat.total / maxAmount) * 100;
                    html += `
                        <div style="margin-bottom: 15px; padding: 15px; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <strong>${stat.name}</strong>
                                <span>${stat.total.toLocaleString()} ØªÙˆÙ…Ø§Ù†</span>
                            </div>
                            <div style="background: #ecf0f1; height: 20px; border-radius: 10px; overflow: hidden;">
                                <div style="background: linear-gradient(45deg, #3498db, #2980b9); height: 100%; width: ${percentage}%; transition: width 0.5s ease;"></div>
                            </div>
                            <small style="color: #7f8c8d;">${stat.transactions} ØªØ±Ø§Ú©Ù†Ø´</small>
                        </div>
                    `;
                });
                
                document.getElementById('stallStatsChart').innerHTML = html || '<p>Ù‡Ù†ÙˆØ² ÙØ±ÙˆØ´ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</p>';
            }
        }

        // ğŸ’³ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¨Ø¯Ù‡Ú©Ø§Ø±Ø§Ù†
        async function loadDebtors() {
            const result = await sendRequest({
                type: 'getDebtors'
            });
            
            if (result.success) {
                const debtors = result.debtors;
                
                let html = '<div class="table-container"><table><thead><tr>';
                html += '<th>Ú©Ø¯</th><th>Ù†Ø§Ù…</th><th>Ú©Ù„Ø§Ø³</th><th>Ù…Ø¬Ù…ÙˆØ¹ Ø¨Ø¯Ù‡ÛŒ</th><th>ØªØ¹Ø¯Ø§Ø¯ Ø®Ø±ÛŒØ¯ Ù†Ø³ÛŒÙ‡</th>';
                html += '</tr></thead><tbody>';
                
                if (debtors.length === 0) {
                    html += '<tr><td colspan="5">Ø¨Ø¯Ù‡Ú©Ø§Ø±ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</td></tr>';
                } else {
                    debtors.forEach(debtor => {
                        html += `<tr>
                            <td>${debtor.code}</td>
                            <td>${debtor.name}</td>
                            <td>${debtor.class}</td>
                            <td>${debtor.totalDebt.toLocaleString()} ØªÙˆÙ…Ø§Ù†</td>
                            <td>${debtor.count}</td>
                        </tr>`;
                    });
                }
                
                html += '</tbody></table></div>';
                document.getElementById('debtorsTable').innerHTML = html;
                
                // Ø°Ø®ÛŒØ±Ù‡ Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ù„ÙˆØ¯
                window.currentDebtors = debtors;
            }
        }

        // ğŸ“Š Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù„ ÙØ±ÙˆØ´â€ŒÙ‡Ø§
        async function loadAllSales() {
            const result = await sendRequest({
                type: 'getAllSales'
            });
            
            if (result.success) {
                const sales = result.sales;
                
                let html = '<div class="table-container"><table><thead><tr>';
                html += '<th>ØªØ§Ø±ÛŒØ®</th><th>Ø³Ø§Ø¹Øª</th><th>Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²</th><th>ØºØ±ÙÙ‡</th><th>Ù…Ø¨Ù„Øº</th><th>Ù†ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø®Øª</th><th>Ø´Ø±Ø­</th>';
                html += '</tr></thead><tbody>';
                
                if (sales.length === 0) {
                    html += '<tr><td colspan="7">Ù‡Ù†ÙˆØ² ÙØ±ÙˆØ´ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</td></tr>';
                } else {
                    sales.forEach(sale => {
                        const paymentBadge = sale.paymentType === 'Ù†Ù‚Ø¯' ? 
                            '<span style="background: #27ae60; color: white; padding: 4px 8px; border-radius: 8px; font-size: 0.8em;">ğŸ’° Ù†Ù‚Ø¯</span>' :
                            '<span style="background: #e74c3c; color: white; padding: 4px 8px; border-radius: 8px; font-size: 0.8em;">ğŸ“ Ù†Ø³ÛŒÙ‡</span>';
                        
                        html += `<tr>
                            <td>${sale.date}</td>
                            <td>${sale.time}</td>
                            <td>${sale.studentName}</td>
                            <td>${sale.stallName}</td>
                            <td>${parseInt(sale.amount).toLocaleString()} ØªÙˆÙ…Ø§Ù†</td>
                            <td>${paymentBadge}</td>
                            <td>${sale.description}</td>
                        </tr>`;
                    });
                }
                
                html += '</tbody></table></div>';
                document.getElementById('allSalesTable').innerHTML = html;
                
                // Ø°Ø®ÛŒØ±Ù‡ Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ù„ÙˆØ¯
                window.currentAllSales = sales;
            }
        }

        // ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯ Excel Ø¨Ø¯Ù‡Ú©Ø§Ø±Ø§Ù†
        function downloadDebtorsExcel() {
            if (!window.currentDebtors || window.currentDebtors.length === 0) {
                showNotification('Ù‡ÛŒÚ† Ø¨Ø¯Ù‡Ú©Ø§Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯', 'error');
                return;
            }
            
            const wb = XLSX.utils.book_new();
            const wsData = [
                ['Ú©Ø¯', 'Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ', 'Ú©Ù„Ø§Ø³', 'Ù…Ø¬Ù…ÙˆØ¹ Ø¨Ø¯Ù‡ÛŒ (ØªÙˆÙ…Ø§Ù†)', 'ØªØ¹Ø¯Ø§Ø¯ Ø®Ø±ÛŒØ¯ Ù†Ø³ÛŒÙ‡']
            ];
            
            window.currentDebtors.forEach(debtor => {
                wsData.push([
                    debtor.code,
                    debtor.name,
                    debtor.class,
                    debtor.totalDebt,
                    debtor.count
                ]);
            });
            
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            XLSX.utils.book_append_sheet(wb, ws, 'Ø¨Ø¯Ù‡Ú©Ø§Ø±Ø§Ù†');
            
            const today = new Date().toLocaleDateString('fa-IR');
            XLSX.writeFile(wb, `Ø¨Ø¯Ù‡Ú©Ø§Ø±Ø§Ù†_${today}.xlsx`);
            
            showNotification('ÙØ§ÛŒÙ„ Excel Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯');
        }

        // ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯ Excel Ú©Ù„ ÙØ±ÙˆØ´â€ŒÙ‡Ø§
        function downloadAllSalesExcel() {
            if (!window.currentAllSales || window.currentAllSales.length === 0) {
                showNotification('Ù‡ÛŒÚ† ÙØ±ÙˆØ´ÛŒ Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯', 'error');
                return;
            }
            
            const wb = XLSX.utils.book_new();
            const wsData = [
                ['ØªØ§Ø±ÛŒØ®', 'Ø³Ø§Ø¹Øª', 'Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²', 'ØºØ±ÙÙ‡', 'Ù…Ø¨Ù„Øº (ØªÙˆÙ…Ø§Ù†)', 'Ù†ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø®Øª', 'Ø´Ø±Ø­ Ø§Ù‚Ù„Ø§Ù…']
            ];
            
            window.currentAllSales.forEach(sale => {
                wsData.push([
                    sale.date,
                    sale.time,
                    sale.studentName,
                    sale.stallName,
                    sale.amount,
                    sale.paymentType,
                    sale.description
                ]);
            });
            
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            XLSX.utils.book_append_sheet(wb, ws, 'Ú©Ù„ ÙØ±ÙˆØ´â€ŒÙ‡Ø§');
            
            const today = new Date().toLocaleDateString('fa-IR');
            XLSX.writeFile(wb, `Ú©Ù„_ÙØ±ÙˆØ´â€ŒÙ‡Ø§_${today}.xlsx`);
            
            showNotification('ÙØ§ÛŒÙ„ Excel Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯');
        }

        // ğŸ“‹ Ø¢Ù¾Ù„ÙˆØ¯ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø§Ø² Excel
        function handleStudentsUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, {header: 1});
                    
                    // Ø­Ø°Ù Ø³Ø·Ø± Ù‡Ø¯Ø± Ùˆ ÙÛŒÙ„ØªØ± Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ÛŒ Ø®Ø§Ù„ÛŒ
                    const students = jsonData.slice(1).filter(row => row.length >= 3 && row[0] && row[1]);
                    
                    if (students.length === 0) {
                        showNotification('ÙØ§ÛŒÙ„ Excel Ø®Ø§Ù„ÛŒ Ø§Ø³Øª ÛŒØ§ ÙØ±Ù…Øª ØµØ­ÛŒØ­ Ù†Ø¯Ø§Ø±Ø¯', 'error');
                        return;
                    }
                    
                    // Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ±
                    sendRequest({
                        type: 'uploadStudents',
                        students: students
                    }).then(result => {
                        if (result.success) {
                            showNotification(`${students.length} Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¢Ù¾Ù„ÙˆØ¯ Ø´Ø¯`);
                            loadAdminStats(); // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¬Ø¯Ø¯ Ø¢Ù…Ø§Ø±
                        } else {
                            showNotification(result.message || 'Ø®Ø·Ø§ Ø¯Ø± Ø¢Ù¾Ù„ÙˆØ¯', 'error');
                        }
                    });
                    
                } catch (error) {
                    console.error('Ø®Ø·Ø§ Ø¯Ø± Ø®ÙˆØ§Ù†Ø¯Ù† ÙØ§ÛŒÙ„:', error);
                    showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø®ÙˆØ§Ù†Ø¯Ù† ÙØ§ÛŒÙ„ Excel', 'error');
                }
            };
            
            reader.readAsArrayBuffer(file);
        }

        // ğŸšª Ø®Ø±ÙˆØ¬
        function logout() {
            currentStall = null;
            selectedStudentData = null;
            document.getElementById('stallCode').value = '';
            document.getElementById('stallPassword').value = '';
            document.getElementById('adminPassword').value = '';
            showPanel('loginSelector');
            showNotification('Ø®Ø±ÙˆØ¬ Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ²');
        }

        // ğŸ¯ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØµÙØ­Ù‡
        document.addEventListener('DOMContentLoaded', function() {
            // Ø¨Ø±Ø±Ø³ÛŒ URL Apps Script
            if (SCRIPT_URL === 'https://script.google.com/macros/s/AKfycbyrhuxHimdZ41WS8MJtTX8B8L55BSI9p6igloKqBxDqJm8vpCudt72IOdjV9i_j2g7k/exec') {
                showNotification('Ù„Ø·ÙØ§Ù‹ URL Google Apps Script Ø±Ø§ Ø¯Ø± Ú©Ø¯ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯', 'error');
            }
        });

        // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø§ Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ ØµÙØ­Ù‡
        document.addEventListener('click', function(e) {
            if (!e.target.closest('#studentSearch') && !e.target.closest('#searchResults')) {
                document.getElementById('searchResults').style.display = 'none';
            }
        });
    </script>
</body>
</html>


