<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¨Ø§Ø²Ø§Ø±Ú†Ù‡ Ø¹Ù„Ø§Ù…Ù‡â€ŒØ­Ù„Ù‘ÛŒ 10</title>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: Tahoma, Arial, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
}

.container {
    background: white;
    border-radius: 20px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    max-width: 500px;
    width: 100%;
    overflow: hidden;
}

.header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    text-align: center;
    padding: 30px 20px;
}

.header.green {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
}

.header.orange {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
}

.header h1 {
    font-size: 24px;
    margin-bottom: 10px;
}

.header p {
    font-size: 14px;
    opacity: 0.9;
}

.content {
    padding: 30px;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    color: #333;
    font-weight: bold;
}

.form-group input,
.form-group select {
    width: 100%;
    padding: 12px;
    border: 2px solid #ddd;
    border-radius: 8px;
    font-size: 14px;
    font-family: Tahoma, Arial, sans-serif;
}

.form-group input:focus,
.form-group select:focus {
    outline: none;
    border-color: #667eea;
}

.btn {
    width: 100%;
    padding: 14px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
    margin-bottom: 10px;
}

.btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
}

.btn-secondary {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    color: white;
}

.btn-secondary:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(17, 153, 142, 0.3);
}

.btn-danger {
    background: linear-gradient(135deg, #f44336 0%, #e91e63 100%);
    color: white;
}

.btn-outline {
    background: white;
    border: 2px solid #667eea;
    color: #667eea;
}

.info-box {
    background: #e3f2fd;
    border-right: 4px solid #2196F3;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
    font-size: 13px;
    line-height: 1.6;
}

.warning-box {
    background: #fff3e0;
    border-right: 4px solid #ff9800;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
    font-size: 13px;
    line-height: 1.6;
}

.balance-card {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    color: white;
    padding: 30px;
    text-align: center;
    margin: 20px;
    border-radius: 15px;
}

.balance-amount {
    font-size: 42px;
    font-weight: bold;
    margin-bottom: 5px;
}

.balance-label {
    font-size: 14px;
    opacity: 0.9;
}

.user-info {
    background: rgba(255,255,255,0.2);
    padding: 15px;
    border-radius: 10px;
    margin: 15px 20px;
    color: white;
}

.user-info div {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
    font-size: 14px;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    padding: 20px;
    background: #f9f9f9;
}

.stat-box {
    background: white;
    padding: 15px;
    border-radius: 10px;
    text-align: center;
}

.stat-value {
    font-size: 20px;
    font-weight: bold;
    color: #667eea;
}

.stat-label {
    font-size: 11px;
    color: #666;
    margin-top: 5px;
}

.transaction-list {
    margin-top: 20px;
}

.transaction-item {
    background: white;
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    border-right: 4px solid #667eea;
}

.transaction-item.charge {
    border-right-color: #4caf50;
}

.transaction-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 5px;
}

.transaction-amount {
    font-weight: bold;
    font-size: 16px;
}

.transaction-amount.positive {
    color: #4caf50;
}

.transaction-amount.negative {
    color: #f44336;
}

.transaction-details {
    font-size: 12px;
    color: #666;
}

.quick-amounts {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
    margin-bottom: 20px;
}

.quick-btn {
    background: #e3f2fd;
    border: 2px solid #2196F3;
    color: #1565C0;
    padding: 10px;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
    text-align: center;
    transition: all 0.3s;
}

.quick-btn:hover {
    background: #2196F3;
    color: white;
    transform: translateY(-2px);
}

.hidden {
    display: none !important;
}

.empty-state {
    text-align: center;
    padding: 40px 20px;
    color: #999;
}

.cloud-status {
    background: #e3f2fd;
    padding: 10px;
    border-radius: 8px;
    margin-bottom: 15px;
    text-align: center;
    font-size: 12px;
}

.cloud-status.syncing {
    background: #fff3e0;
}

.cloud-status.error {
    background: #ffebee;
    color: #c62828;
}

.cloud-status.success {
    background: #e8f5e8;
    color: #2e7d32;
}
</style>
</head>
<body>

<!-- ØµÙØ­Ù‡ Ø®ÙˆØ´â€ŒØ¢Ù…Ø¯Ú¯ÙˆÛŒÛŒ -->
<div id="welcomePage" class="container">
    <div class="header">
        <h1>ğŸ“ Ø¨Ø§Ø²Ø§Ø±Ú†Ù‡ Ø¹Ù„Ø§Ù…Ù‡â€ŒØ­Ù„Ù‘ÛŒ 10</h1>
        <p>Ø³ÛŒØ³ØªÙ… Ù¾Ø±Ø¯Ø§Ø®Øª Ø§Ø¨Ø±ÛŒ - Ø¯Ø§Ø¦Ù…ÛŒ</p>
    </div>
    <div class="content">
        <div class="info-box">
            ğŸ‘‹ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯! Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¯Ø± ÙØ¶Ø§ÛŒ Ø§Ø¨Ø±ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ Ùˆ Ø§Ø² Ù‡Ù…Ù‡ Ø¯Ø³ØªÚ¯Ø§Ù‡â€ŒÙ‡Ø§ Ù‚Ø§Ø¨Ù„ Ø¯Ø³ØªØ±Ø³ÛŒ Ù‡Ø³ØªÙ†Ø¯.
        </div>
        <div class="cloud-status" id="cloudStatus">
            â˜ï¸ Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„ Ø¨Ù‡ ÙØ¶Ø§ÛŒ Ø§Ø¨Ø±ÛŒ...
        </div>
        <button class="btn btn-primary" onclick="goToRegister()">
            âœ¨ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… (Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯)
        </button>
        <button class="btn btn-secondary" onclick="goToLogin()">
            ğŸ”‘ ÙˆØ±ÙˆØ¯ (Ù‚Ø¨Ù„Ø§Ù‹ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ø±Ø¯Ù‡â€ŒØ§Ù…)
        </button>
        <button class="btn btn-outline" onclick="goToAdmin()">
            ğŸ‘¨â€ğŸ’¼ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª
        </button>
        <button class="btn btn-outline" onclick="forceCloudSync()">
            ğŸ”„ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ Ø§Ø¨Ø±
        </button>
        <div class="info-box" style="margin-top: 15px; font-size: 12px;">
            ğŸ’¡ Ø³ÛŒØ³ØªÙ… Ø¨Ù‡ Ø·ÙˆØ± Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø§ ÙØ¶Ø§ÛŒ Ø§Ø¨Ø±ÛŒ Ù‡Ù…Ú¯Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯. Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§Ø² Ø¯Ø³Øª Ù†Ù…ÛŒâ€ŒØ±ÙˆÙ†Ø¯!
        </div>
    </div>
</div>

<!-- Ø¨Ù‚ÛŒÙ‡ ØµÙØ­Ø§Øª Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ Ù…Ø«Ù„ Ú©Ø¯ Ù‚Ø¨Ù„ÛŒ Ù‡Ø³ØªÙ†Ø¯ -->
<!-- ØµÙØ­Ù‡ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… -->
<div id="registerPage" class="container hidden">
    <div class="header">
        <h1>ğŸ“ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</h1>
        <p>Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯</p>
    </div>
    <div class="content">
        <div class="warning-box">
            âš ï¸ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø´Ù…Ø§ <strong>Û° ØªÙˆÙ…Ø§Ù†</strong> Ø§Ø³Øª. Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ø§Ø¹ØªØ¨Ø§Ø± Ø¨Ù‡ ØºØ±ÙÙ‡ Ø´Ø§Ø±Ú˜ Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ú©Ù†ÛŒØ¯.
        </div>
        
        <div class="form-group">
            <label>ğŸ‘¤ Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</label>
            <input type="text" id="regName" placeholder="Ù…Ø«Ø§Ù„: Ø¹Ù„ÛŒ Ø§Ø­Ù…Ø¯ÛŒ">
        </div>
        
        <div class="form-group">
            <label>ğŸ†” Ú©Ø¯ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ</label>
            <input type="text" id="regCode" placeholder="Ù…Ø«Ø§Ù„: 12345">
        </div>
        
        <button class="btn btn-primary" onclick="doRegister()">
            âœ¨ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…
        </button>
        
        <button class="btn btn-outline" onclick="goToWelcome()">
            â† Ø¨Ø§Ø²Ú¯Ø´Øª
        </button>
    </div>
</div>

<!-- ØµÙØ­Ù‡ ÙˆØ±ÙˆØ¯ -->
<div id="loginPage" class="container hidden">
    <div class="header green">
        <h1>ğŸ” ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ…</h1>
        <p>Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø¯ÛŒØ¬ÛŒØªØ§Ù„</p>
    </div>
    <div class="content">
        <div class="form-group">
            <label>ğŸ‘¤ Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</label>
            <input type="text" id="loginName" placeholder="Ù…Ø«Ø§Ù„: Ø¹Ù„ÛŒ Ø§Ø­Ù…Ø¯ÛŒ">
        </div>
        
        <div class="form-group">
            <label>ğŸ†” Ú©Ø¯ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ</label>
            <input type="text" id="loginCode" placeholder="Ù…Ø«Ø§Ù„: 12345">
        </div>
        
        <button class="btn btn-secondary" onclick="doLogin()">
            ğŸš€ ÙˆØ±ÙˆØ¯
        </button>
        
        <button class="btn btn-outline" onclick="goToWelcome()">
            â† Ø¨Ø§Ø²Ú¯Ø´Øª
        </button>
    </div>
</div>

<!-- ØµÙØ­Ù‡ Ú©ÛŒÙ Ù¾ÙˆÙ„ -->
<div id="walletPage" class="container hidden">
    <div class="header green">
        <h1>ğŸ’¼ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø¯ÛŒØ¬ÛŒØªØ§Ù„</h1>
        <p>Ø¨Ø§Ø²Ø§Ø±Ú†Ù‡ Ø¹Ù„Ø§Ù…Ù‡â€ŒØ­Ù„Ù‘ÛŒ</p>
        <div class="user-info">
            <div><span>ğŸ‘¤ Ù†Ø§Ù…:</span><strong id="userName"></strong></div>
            <div><span>ğŸ†” Ú©Ø¯:</span><strong id="userCode"></strong></div>
        </div>
    </div>
    
    <div class="balance-card">
        <div class="balance-amount" id="userBalance">0</div>
        <div class="balance-label">ØªÙˆÙ…Ø§Ù† Ù…ÙˆØ¬ÙˆØ¯ÛŒ</div>
    </div>
    
    <div class="stats-grid">
        <div class="stat-box">
            <div class="stat-value" id="statCharges">0</div>
            <div class="stat-label">Ø´Ø§Ø±Ú˜</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="statPayments">0</div>
            <div class="stat-label">Ø®Ø±ÛŒØ¯</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="statSpent">0</div>
            <div class="stat-label">Ù‡Ø²ÛŒÙ†Ù‡</div>
        </div>
    </div>
    
    <div class="content">
        <h3 style="margin-bottom: 15px;">ğŸ’¸ Ù¾Ø±Ø¯Ø§Ø®Øª Ø³Ø±ÛŒØ¹</h3>
        
        <div class="quick-amounts">
            <div class="quick-btn" onclick="setQuickAmount(1000)">Û±,Û°Û°Û°</div>
            <div class="quick-btn" onclick="setQuickAmount(2000)">Û²,Û°Û°Û°</div>
            <div class="quick-btn" onclick="setQuickAmount(5000)">Ûµ,Û°Û°Û°</div>
            <div class="quick-btn" onclick="setQuickAmount(10000)">Û±Û°,Û°Û°Û°</div>
        </div>
        
        <div class="form-group">
            <label>ğŸª Ø§Ù†ØªØ®Ø§Ø¨ ØºØ±ÙÙ‡</label>
            <select id="standSelect">
                <option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ --</option>
            </select>
        </div>
        
        <div class="form-group">
            <label>ğŸ’° Ù…Ø¨Ù„Øº (ØªÙˆÙ…Ø§Ù†)</label>
            <input type="number" id="payAmount" placeholder="Ù…Ø¨Ù„Øº Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯" min="0">
        </div>
        
        <div class="form-group">
            <label>ğŸ“ ØªÙˆØ¶ÛŒØ­Ø§Øª (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</label>
            <input type="text" id="payDesc" placeholder="ØªÙˆØ¶ÛŒØ­ Ø®Ø±ÛŒØ¯...">
        </div>
        
        <button class="btn btn-primary" onclick="doPayment()">
            âœ… Ù¾Ø±Ø¯Ø§Ø®Øª Ùˆ Ø®Ø±ÛŒØ¯
        </button>
        
        <div class="transaction-list">
            <h3 style="margin-bottom: 15px;">ğŸ“‹ ØªØ§Ø±ÛŒØ®Ú†Ù‡ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§</h3>
            <div id="transactionsList"></div>
        </div>
        
        <button class="btn btn-danger" onclick="doLogout()">
            ğŸšª Ø®Ø±ÙˆØ¬ Ø§Ø² Ø³ÛŒØ³ØªÙ…
        </button>
    </div>
</div>

<!-- ØµÙØ­Ù‡ ÙˆØ±ÙˆØ¯ Ø§Ø¯Ù…ÛŒÙ† -->
<div id="adminLoginPage" class="container hidden">
    <div class="header orange">
        <h1>ğŸ‘¨â€ğŸ’¼ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</h1>
        <p>ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª</p>
    </div>
    <div class="content">
        <div class="warning-box">
            ğŸ” Ø§ÛŒÙ† Ø¨Ø®Ø´ ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ… Ø§Ø³Øª.
        </div>
        
        <div class="form-group">
            <label>ğŸ”‘ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ù…Ø¯ÛŒØ±ÛŒØª</label>
            <input type="password" id="adminPassword" placeholder="Ø±Ù…Ø² Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯">
        </div>
        
        <button class="btn btn-primary" onclick="doAdminLogin()">
            ğŸš€ ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ù¾Ù†Ù„
        </button>
        
        <button class="btn btn-outline" onclick="goToWelcome()">
            â† Ø¨Ø§Ø²Ú¯Ø´Øª
        </button>
        
        <div class="info-box" style="margin-top: 20px;">
            ğŸ’¡ Ø±Ù…Ø² Ù¾ÛŒØ´â€ŒÙØ±Ø¶: <code>adBazaar@1404#Helli10</code>
        </div>
    </div>
</div>

<!-- Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª -->
<div id="adminDashboard" class="container hidden">
    <div class="header orange">
        <h1>ğŸ“Š Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø¯ÛŒØ±ÛŒØª</h1>
        <p>Ø¨Ø§Ø²Ø§Ø±Ú†Ù‡ Ø¹Ù„Ø§Ù…Ù‡â€ŒØ­Ù„Ù‘ÛŒ</p>
    </div>
    
    <div class="stats-grid">
        <div class="stat-box">
            <div class="stat-value" id="adminStudents">0</div>
            <div class="stat-label">ğŸ‘¥ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="adminStands">0</div>
            <div class="stat-label">ğŸª ØºØ±ÙÙ‡â€ŒÙ‡Ø§</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="adminMoney">0</div>
            <div class="stat-label">ğŸ’° Ú©Ù„ Ø´Ø§Ø±Ú˜</div>
        </div>
    </div>
    
    <div class="content">
        <h3 style="margin-bottom: 15px;">âš¡ Ø´Ø§Ø±Ú˜ Ø­Ø³Ø§Ø¨ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²</h3>
        
        <div class="form-group">
            <label>ğŸ‘¤ Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²</label>
            <select id="chargeStudentSelect">
                <option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ --</option>
            </select>
        </div>
        
        <div class="form-group">
            <label>ğŸ’µ Ù…Ø¨Ù„Øº Ø´Ø§Ø±Ú˜ (ØªÙˆÙ…Ø§Ù†)</label>
            <input type="number" id="chargeAmount" placeholder="Ù…Ø¨Ù„Øº Ø´Ø§Ø±Ú˜" min="0">
        </div>
        
        <div class="form-group">
            <label>ğŸ’¸ Ù…Ø¨Ù„Øº Ù†Ù‚Ø¯ÛŒ Ø¯Ø±ÛŒØ§ÙØªÛŒ (ØªÙˆÙ…Ø§Ù†)</label>
            <input type="number" id="cashReceived" placeholder="Ù…Ø¨Ù„Øº Ù†Ù‚Ø¯ÛŒ" min="0">
        </div>
        
        <div class="form-group">
            <label>ğŸ“ ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
            <input type="text" id="chargeDesc" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª Ø´Ø§Ø±Ú˜...">
        </div>
        
        <button class="btn btn-primary" onclick="doCharge()">
            âš¡ Ø´Ø§Ø±Ú˜ Ø­Ø³Ø§Ø¨
        </button>
        
        <button class="btn btn-secondary" onclick="showAddStand()">
            â• Ø§ÙØ²ÙˆØ¯Ù† ØºØ±ÙÙ‡ Ø¬Ø¯ÛŒØ¯
        </button>
        
        <button class="btn btn-outline" onclick="downloadData()">
            ğŸ’¾ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø¨Ú©â€ŒØ¢Ù¾
        </button>
        
        <button class="btn btn-danger" onclick="resetAll()">
            ğŸ—‘ï¸ Ø±ÛŒØ³Øª Ú©Ø§Ù…Ù„ Ø³ÛŒØ³ØªÙ…
        </button>
        
        <div class="transaction-list">
            <h3 style="margin-bottom: 15px;">ğŸ“‹ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø´Ø§Ø±Ú˜Ù‡Ø§</h3>
            <div id="chargeHistoryList"></div>
        </div>
        
        <button class="btn btn-outline" onclick="doAdminLogout()">
            ğŸšª Ø®Ø±ÙˆØ¬ Ø§Ø² Ù¾Ù†Ù„
        </button>
    </div>
</div>

<script>
// ØªÙ†Ø¸ÛŒÙ…Ø§Øª
const CLOUD_BIN_ID = '67d4a5e1e41a3a3429b7c5f6'; // Ø§ÛŒÙ† ID Ø¨Ø±Ø§ÛŒ ÙØ¶Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø§Ø¨Ø±ÛŒ Ø´Ù…Ø§Ø³Øª
let currentUser = null;
const ADMIN_PASS = 'adBazaar@1404#Helli10';

// Ù…Ø¯ÛŒØ±ÛŒØª ØµÙØ­Ø§Øª
function hideAll() {
    document.querySelectorAll('.container').forEach(el => {
        el.classList.add('hidden');
    });
}

function showPage(pageId) {
    hideAll();
    document.getElementById(pageId).classList.remove('hidden');
}

// ØµÙØ­Ù‡ Ø®ÙˆØ´â€ŒØ¢Ù…Ø¯Ú¯ÙˆÛŒÛŒ
function goToWelcome() {
    showPage('welcomePage');
}

function goToRegister() {
    showPage('registerPage');
}

function goToLogin() {
    showPage('loginPage');
}

function goToAdmin() {
    showPage('adminLoginPage');
}

// Ø³ÛŒØ³ØªÙ… Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø§Ø¨Ø±ÛŒ Ø¨Ø§ JSONBin.io
async function saveToCloud(data) {
    try {
        const response = await fetch(`https://api.jsonbin.io/v3/b/${CLOUD_BIN_ID}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'X-Master-Key': '$2a$10$6LZNLBZQ3CmQy5l5b5b5b5b5b5b5b5b5b5b5b5b5b5b5b5b5b5b5b5b'
            },
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        return result.record ? true : false;
    } catch (error) {
        console.error('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø§Ø¨Ø±ÛŒ:', error);
        return false;
    }
}

async function loadFromCloud() {
    try {
        const response = await fetch(`https://api.jsonbin.io/v3/b/${CLOUD_BIN_ID}/latest`, {
            headers: {
                'X-Master-Key': '$2a$10$6LZNLBZQ3CmQy5l5b5b5b5b5b5b5b5b5b5b5b5b5b5b5b5b5b5b5b5b'
            }
        });
        
        const result = await response.json();
        return result.record || {
            students: [],
            stands: [],
            charges: [],
            payments: []
        };
    } catch (error) {
        console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø² Ø§Ø¨Ø±:', error);
        return {
            students: [],
            stands: [],
            charges: [],
            payments: []
        };
    }
}

// Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
async function loadAllData() {
    updateCloudStatus('â˜ï¸ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø² ÙØ¶Ø§ÛŒ Ø§Ø¨Ø±ÛŒ...', 'syncing');
    
    try {
        const cloudData = await loadFromCloud();
        
        // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± localStorage
        localStorage.setItem('students', JSON.stringify(cloudData.students || []));
        localStorage.setItem('stands', JSON.stringify(cloudData.stands || []));
        localStorage.setItem('chargeHistory', JSON.stringify(cloudData.charges || []));
        localStorage.setItem('paymentHistory', JSON.stringify(cloudData.payments || []));

        updateCloudStatus('âœ… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§Ø² Ø§Ø¨Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯', 'success');
        return true;
    } catch (error) {
        updateCloudStatus('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø² Ø§Ø¨Ø±', 'error');
        return false;
    }
}

async function saveAllData() {
    updateCloudStatus('â˜ï¸ Ø¯Ø± Ø­Ø§Ù„ Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± ÙØ¶Ø§ÛŒ Ø§Ø¨Ø±ÛŒ...', 'syncing');
    
    try {
        const dataToSave = {
            students: JSON.parse(localStorage.getItem('students') || '[]'),
            stands: JSON.parse(localStorage.getItem('stands') || '[]'),
            charges: JSON.parse(localStorage.getItem('chargeHistory') || '[]'),
            payments: JSON.parse(localStorage.getItem('paymentHistory') || '[]'),
            lastSync: new Date().toISOString()
        };

        const success = await saveToCloud(dataToSave);
        
        if (success) {
            updateCloudStatus('âœ… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¯Ø± Ø§Ø¨Ø± Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯', 'success');
        } else {
            updateCloudStatus('âš ï¸ Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø§Ø¨Ø±ÛŒ', 'error');
        }
        
        return success;
    } catch (error) {
        updateCloudStatus('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ', 'error');
        return false;
    }
}

function updateCloudStatus(message, type = '') {
    const statusEl = document.getElementById('cloudStatus');
    if (statusEl) {
        statusEl.textContent = message;
        statusEl.className = `cloud-status ${type}`;
    }
}

async function forceCloudSync() {
    await saveAllData();
}

// Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…
async function doRegister() {
    const name = document.getElementById('regName').value.trim();
    const code = document.getElementById('regCode').value.trim();
    
    if (!name || !code) {
        alert('âŒ Ù„Ø·ÙØ§Ù‹ Ù‡Ù…Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯');
        return;
    }
    
    if (code.length < 3) {
        alert('âŒ Ú©Ø¯ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ Û³ Ø±Ù‚Ù… Ø¨Ø§Ø´Ø¯');
        return;
    }
    
    let students = JSON.parse(localStorage.getItem('students') || '[]');
    
    if (students.find(s => s.code === code)) {
        alert('âŒ Ø§ÛŒÙ† Ú©Ø¯ Ù‚Ø¨Ù„Ø§Ù‹ Ø«Ø¨Øª Ø´Ø¯Ù‡ Ø§Ø³Øª');
        return;
    }
    
    const newStudent = {
        name: name,
        code: code,
        balance: 0,
        createdAt: new Date().toISOString()
    };
    
    students.push(newStudent);
    localStorage.setItem('students', JSON.stringify(students));
    
    // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± ÙØ¶Ø§ÛŒ Ø§Ø¨Ø±ÛŒ
    await saveAllData();
    
    alert(`âœ… Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ù…ÙˆÙÙ‚!\n\nØ®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ ${name}\nÚ©Ø¯ Ø´Ù…Ø§: ${code}\n\nÙ…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ Û° ØªÙˆÙ…Ø§Ù† Ø§Ø³Øª.`);
    
    currentUser = newStudent;
    localStorage.setItem('currentUser', JSON.stringify(currentUser));
    
    document.getElementById('regName').value = '';
    document.getElementById('regCode').value = '';
    
    loadWallet();
    showPage('walletPage');
}

// ÙˆØ±ÙˆØ¯
function doLogin() {
    const name = document.getElementById('loginName').value.trim();
    const code = document.getElementById('loginCode').value.trim();
    
    if (!name || !code) {
        alert('âŒ Ù„Ø·ÙØ§Ù‹ Ù‡Ù…Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯');
        return;
    }
    
    let students = JSON.parse(localStorage.getItem('students') || '[]');
    let student = students.find(s => s.code === code && s.name === name);
    
    if (!student) {
        alert('âŒ Ù†Ø§Ù… ÛŒØ§ Ú©Ø¯ Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª');
        return;
    }
    
    currentUser = student;
    localStorage.setItem('currentUser', JSON.stringify(currentUser));
    
    document.getElementById('loginName').value = '';
    document.getElementById('loginCode').value = '';
    
    loadWallet();
    showPage('walletPage');
}

// Ø®Ø±ÙˆØ¬
function doLogout() {
    if (confirm('Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø®Ø§Ø±Ø¬ Ø´ÙˆÛŒØ¯ØŸ')) {
        currentUser = null;
        localStorage.removeItem('currentUser');
        goToWelcome();
    }
}

// Ú©ÛŒÙ Ù¾ÙˆÙ„
function loadWallet() {
    if (!currentUser) {
        goToWelcome();
        return;
    }
    
    // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø² localStorage
    let students = JSON.parse(localStorage.getItem('students') || '[]');
    let updated = students.find(s => s.code === currentUser.code);
    if (updated) {
        currentUser = updated;
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
    }
    
    document.getElementById('userName').textContent = currentUser.name;
    document.getElementById('userCode').textContent = currentUser.code;
    document.getElementById('userBalance').textContent = currentUser.balance.toLocaleString('fa-IR');
    
    loadWalletStats();
    loadStandsList();
    loadUserTransactions();
}

function loadWalletStats() {
    const charges = JSON.parse(localStorage.getItem('chargeHistory') || '[]');
    const payments = JSON.parse(localStorage.getItem('paymentHistory') || '[]');
    
    const myCharges = charges.filter(c => c.studentCode === currentUser.code);
    const myPayments = payments.filter(p => p.studentCode === currentUser.code);
    
    const totalSpent = myPayments.reduce((sum, p) => sum + p.amount, 0);
    
    document.getElementById('statCharges').textContent = myCharges.length;
    document.getElementById('statPayments').textContent = myPayments.length;
    document.getElementById('statSpent').textContent = totalSpent.toLocaleString('fa-IR');
}

function loadStandsList() {
    const stands = JSON.parse(localStorage.getItem('stands') || '[]');
    const select = document.getElementById('standSelect');
    
    select.innerHTML = '<option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ --</option>';
    
    stands.forEach(stand => {
        const option = document.createElement('option');
        option.value = stand.code;
        option.textContent = `${stand.name} (${stand.code})`;
        select.appendChild(option);
    });
}

function loadUserTransactions() {
    const charges = JSON.parse(localStorage.getItem('chargeHistory') || '[]');
    const payments = JSON.parse(localStorage.getItem('paymentHistory') || '[]');
    
    const myCharges = charges.filter(c => c.studentCode === currentUser.code).map(c => ({
        ...c, type: 'charge'
    }));
    
    const myPayments = payments.filter(p => p.studentCode === currentUser.code).map(p => ({
        ...p, type: 'payment'
    }));
    
    const all = [...myCharges, ...myPayments]
        .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
        .slice(0, 20);
    
    const container = document.getElementById('transactionsList');
    
    if (all.length === 0) {
        container.innerHTML = '<div class="empty-state">ğŸ“­ Ù‡Ù†ÙˆØ² ØªØ±Ø§Ú©Ù†Ø´ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</div>';
        return;
    }
    
    container.innerHTML = all.map(t => {
        const isCharge = t.type === 'charge';
        const sign = isCharge ? '+' : '-';
        const cls = isCharge ? 'charge' : '';
        const amtCls = isCharge ? 'positive' : 'negative';
        const label = isCharge ? 'Ø´Ø§Ø±Ú˜ ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ†' : `Ø®Ø±ÛŒØ¯ Ø§Ø² ${t.standName || ''}`;
        
        return `
            <div class="transaction-item ${cls}">
                <div class="transaction-header">
                    <div>${label}</div>
                    <div class="transaction-amount ${amtCls}">${sign}${t.amount.toLocaleString('fa-IR')}</div>
                </div>
                <div class="transaction-details">
                    ${t.description || 'â€”'} â€¢ ${new Date(t.timestamp).toLocaleString('fa-IR')}
                </div>
            </div>
        `;
    }).join('');
}

function setQuickAmount(amount) {
    document.getElementById('payAmount').value = amount;
}

// Ù¾Ø±Ø¯Ø§Ø®Øª
async function doPayment() {
    const standCode = document.getElementById('standSelect').value;
    const amount = parseInt(document.getElementById('payAmount').value);
    const description = document.getElementById('payDesc').value.trim();
    
    if (!standCode) {
        alert('âŒ Ù„Ø·ÙØ§Ù‹ ØºØ±ÙÙ‡ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯');
        return;
    }
    
    if (!amount || amount <= 0) {
        alert('âŒ Ù…Ø¨Ù„Øº Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª');
        return;
    }
    
    if (amount > currentUser.balance) {
        alert(`âŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª!\nÙ…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§: ${currentUser.balance.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†`);
        return;
    }
    
    const stands = JSON.parse(localStorage.getItem('stands') || '[]');
    const stand = stands.find(s => s.code === standCode);
    
    if (!stand) {
        alert('âŒ ØºØ±ÙÙ‡ ÛŒØ§ÙØª Ù†Ø´Ø¯');
        return;
    }
    
    // Ú©Ø³Ø± Ù…ÙˆØ¬ÙˆØ¯ÛŒ
    currentUser.balance -= amount;
    
    // Ø°Ø®ÛŒØ±Ù‡ Ú©Ø§Ø±Ø¨Ø±
    let students = JSON.parse(localStorage.getItem('students') || '[]');
    students = students.map(s => s.code === currentUser.code ? currentUser : s);
    localStorage.setItem('students', JSON.stringify(students));
    localStorage.setItem('currentUser', JSON.stringify(currentUser));
    
    // Ø«Ø¨Øª Ù¾Ø±Ø¯Ø§Ø®Øª
    let payments = JSON.parse(localStorage.getItem('paymentHistory') || '[]');
    payments.push({
        studentName: currentUser.name,
        studentCode: currentUser.code,
        standName: stand.name,
        standCode: stand.code,
        amount: amount,
        description: description || 'Ø®Ø±ÛŒØ¯',
        timestamp: new Date().toISOString()
    });
    localStorage.setItem('paymentHistory', JSON.stringify(payments));
    
    // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± ÙØ¶Ø§ÛŒ Ø§Ø¨Ø±ÛŒ
    await saveAllData();
    
    // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ±Ù…
    document.getElementById('standSelect').value = '';
    document.getElementById('payAmount').value = '';
    document.getElementById('payDesc').value = '';
    
    alert(`âœ… Ù¾Ø±Ø¯Ø§Ø®Øª Ù…ÙˆÙÙ‚!\n${amount.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† Ø¨Ù‡ "${stand.name}" Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯.`);
    
    loadWallet();
}

// Ø§Ø¯Ù…ÛŒÙ† - ÙˆØ±ÙˆØ¯
function doAdminLogin() {
    const pass = document.getElementById('adminPassword').value;
    
    if (pass === ADMIN_PASS) {
        document.getElementById('adminPassword').value = '';
        loadAdminDashboard();
        showPage('adminDashboard');
    } else {
        alert('âŒ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª');
    }
}

function doAdminLogout() {
    if (confirm('Ø®Ø±ÙˆØ¬ Ø§Ø² Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØªØŸ')) {
        goToWelcome();
    }
}

// Ø§Ø¯Ù…ÛŒÙ† - Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
function loadAdminDashboard() {
    const students = JSON.parse(localStorage.getItem('students') || '[]');
    const stands = JSON.parse(localStorage.getItem('stands') || '[]');
    const charges = JSON.parse(localStorage.getItem('chargeHistory') || '[]');
    
    const totalMoney = charges.reduce((sum, c) => sum + c.amount, 0);
    
    document.getElementById('adminStudents').textContent = students.length;
    document.getElementById('adminStands').textContent = stands.length;
    document.getElementById('adminMoney').textContent = totalMoney.toLocaleString('fa-IR');
    
    // Ù„ÛŒØ³Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†
    const select = document.getElementById('chargeStudentSelect');
    select.innerHTML = '<option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ --</option>';
    
    students.forEach(student => {
        const option = document.createElement('option');
        option.value = student.code;
        option.textContent = `${student.name} (${student.code}) - ${student.balance.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù†`;
        select.appendChild(option);
    });
    
    // ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø´Ø§Ø±Ú˜
    loadChargeHistory();
}

function loadChargeHistory() {
    const charges = JSON.parse(localStorage.getItem('chargeHistory') || '[]');
    const container = document.getElementById('chargeHistoryList');
    
    if (charges.length === 0) {
        container.innerHTML = '<div class="empty-state">ğŸ“­ Ù‡Ù†ÙˆØ² Ø´Ø§Ø±Ú˜ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</div>';
        return;
    }
    
    const sorted = charges.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)).slice(0, 20);
    
    container.innerHTML = sorted.map(c => `
        <div class="transaction-item charge">
            <div class="transaction-header">
                <div>${c.studentName} (${c.studentCode})</div>
                <div class="transaction-amount positive">+${c.amount.toLocaleString('fa-IR')}</div>
            </div>
            <div class="transaction-details">
                ğŸ’µ Ù†Ù‚Ø¯ÛŒ: ${c.cashReceived.toLocaleString('fa-IR')} â€¢ ${c.description || 'â€”'} â€¢ ${new Date(c.timestamp).toLocaleString('fa-IR')}
            </div>
        </div>
    `).join('');
}

// Ø´Ø§Ø±Ú˜ Ø­Ø³Ø§Ø¨
async function doCharge() {
    const studentCode = document.getElementById('chargeStudentSelect').value;
    const amount = parseInt(document.getElementById('chargeAmount').value);
    const cash = parseInt(document.getElementById('cashReceived').value);
    const description = document.getElementById('chargeDesc').value.trim();
    
    if (!studentCode) {
        alert('âŒ Ù„Ø·ÙØ§Ù‹ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯');
        return;
    }
    
    if (!amount || amount <= 0) {
        alert('âŒ Ù…Ø¨Ù„Øº Ø´Ø§Ø±Ú˜ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª');
        return;
    }
    
    if (!cash || cash < 0) {
        alert('âŒ Ù…Ø¨Ù„Øº Ù†Ù‚Ø¯ÛŒ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª');
        return;
    }
    
    let students = JSON.parse(localStorage.getItem('students') || '[]');
    let student = students.find(s => s.code === studentCode);
    
    if (!student) {
        alert('âŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² ÛŒØ§ÙØª Ù†Ø´Ø¯');
        return;
    }
    
    // Ø§ÙØ²Ø§ÛŒØ´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ
    student.balance += amount;
    
    students = students.map(s => s.code === studentCode ? student : s);
    localStorage.setItem('students', JSON.stringify(students));
    
    // Ø«Ø¨Øª Ø´Ø§Ø±Ú˜
    let charges = JSON.parse(localStorage.getItem('chargeHistory') || '[]');
    charges.push({
        studentName: student.name,
        studentCode: student.code,
        amount: amount,
        cashReceived: cash,
        description: description || 'Ø´Ø§Ø±Ú˜ Ø­Ø³Ø§Ø¨',
        timestamp: new Date().toISOString()
    });
    localStorage.setItem('chargeHistory', JSON.stringify(charges));
    
    // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± ÙØ¶Ø§ÛŒ Ø§Ø¨Ø±ÛŒ
    await saveAllData();
    
    // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ±Ù…
    document.getElementById('chargeStudentSelect').value = '';
    document.getElementById('chargeAmount').value = '';
    document.getElementById('cashReceived').value = '';
    document.getElementById('chargeDesc').value = '';
    
    alert(`âœ… Ø´Ø§Ø±Ú˜ Ù…ÙˆÙÙ‚!\n${amount.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† Ø¨Ù‡ Ø­Ø³Ø§Ø¨ "${student.name}" Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.`);
    
    loadAdminDashboard();
}

// Ø§ÙØ²ÙˆØ¯Ù† ØºØ±ÙÙ‡
async function showAddStand() {
    const name = prompt('Ù†Ø§Ù… ØºØ±ÙÙ‡:');
    if (!name) return;
    
    const code = prompt('Ú©Ø¯ ØºØ±ÙÙ‡:');
    if (!code) return;
    
    let stands = JSON.parse(localStorage.getItem('stands') || '[]');
    
    if (stands.find(s => s.code === code)) {
        alert('âŒ Ø§ÛŒÙ† Ú©Ø¯ Ù‚Ø¨Ù„Ø§Ù‹ Ø«Ø¨Øª Ø´Ø¯Ù‡ Ø§Ø³Øª');
        return;
    }
    
    stands.push({ name, code });
    localStorage.setItem('stands', JSON.stringify(stands));
    
    // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± ÙØ¶Ø§ÛŒ Ø§Ø¨Ø±ÛŒ
    await saveAllData();
    
    alert(`âœ… ØºØ±ÙÙ‡ "${name}" Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯`);
    loadAdminDashboard();
}

function downloadData() {
    const data = {
        students: JSON.parse(localStorage.getItem('students') || '[]'),
        stands: JSON.parse(localStorage.getItem('stands') || '[]'),
        chargeHistory: JSON.parse(localStorage.getItem('chargeHistory') || '[]'),
        paymentHistory: JSON.parse(localStorage.getItem('paymentHistory') || '[]'),
        exportDate: new Date().toISOString()
    };
    
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `backup-${new Date().toISOString().split('T')[0]}.json`;
    a.click();
    URL.revokeObjectURL(url);
    
    alert('âœ… ÙØ§ÛŒÙ„ Ø¨Ú©â€ŒØ¢Ù¾ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯');
}

async function resetAll() {
    if (!confirm('âš ï¸ Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù†ÛŒØ¯ØŸ ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø­Ø°Ù Ù…ÛŒâ€ŒØ´ÙˆØ¯!')) return;
    if (!confirm('âš ï¸ Ø¢Ø®Ø±ÛŒÙ† Ù‡Ø´Ø¯Ø§Ø±! Ø§ÛŒÙ† Ø¹Ù…Ù„ Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ù†ÛŒØ³Øª.')) return;
    
    localStorage.clear();
    
    // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§Ø² ÙØ¶Ø§ÛŒ Ø§Ø¨Ø±ÛŒ
    await saveToCloud({
        students: [],
        stands: [],
        charges: [],
        payments: [],
        resetAt: new Date().toISOString()
    });
    
    alert('âœ… Ø³ÛŒØ³ØªÙ… Ø±ÛŒØ³Øª Ø´Ø¯');
    goToWelcome();
}

// Ø´Ø±ÙˆØ¹ Ø¨Ø±Ù†Ø§Ù…Ù‡
window.addEventListener('DOMContentLoaded', async function() {
    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§Ø² ÙØ¶Ø§ÛŒ Ø§Ø¨Ø±ÛŒ
    await loadAllData();
    
    // Ø¨Ø±Ø±Ø³ÛŒ Ú©Ø§Ø±Ø¨Ø± Ù‚Ø¨Ù„ÛŒ
    const savedUser = localStorage.getItem('currentUser');
    if (savedUser) {
        currentUser = JSON.parse(savedUser);
        loadWallet();
        showPage('walletPage');
    } else {
        showPage('welcomePage');
    }
    
    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ØºØ±ÙÙ‡â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶
    if (!localStorage.getItem('stands') || JSON.parse(localStorage.getItem('stands')).length === 0) {
        localStorage.setItem('stands', JSON.stringify([
            { name: 'ØºØ±ÙÙ‡ ØºØ°Ø§', code: 'FOOD1' },
            { name: 'ØºØ±ÙÙ‡ Ù†ÙˆØ´ÛŒØ¯Ù†ÛŒ', code: 'DRINK1' },
            { name: 'ØºØ±ÙÙ‡ Ø¨Ø§Ø²ÛŒ', code: 'GAME1' }
        ]));
        await saveAllData();
    }
});
</script>

</body>
</html>
